<% builds[:update_failed].each do |server| %>
  <div class="project failure">Update Failed on <%=server %> (You may have left the gate open)</div>
<% end %>

<% if builds[:failure].any? || builds[:building].any? %>
  <% builds[:failure].each do |checker| %>
    <%= erb :checker, :locals => {:checker => checker, :status => :failure} %>
  <% end %>
  <% builds[:building].each do |checker| %>
    <%= erb :checker, :locals => {:checker => checker, :status => :building} %>
  <% end %>
  <% if builds[:success].any? %>
    <div class="project success"><%= builds[:success].length %> other heifers are just dandy</div>
  <% end %>
<% elsif builds[:success].any? %>
  <div class="ok">All <%= builds[:success].length %> heifers happy as pigs in muck</div>
<% end %>

<% unless data_integrity.nil? || data_integrity['valid'] %>
  <div class="data-integrity project failure">
    Data Integrity Checker failed.
    <ul>
      <% data_integrity["errors"].each do |error|  %>
        <li><%= error.gsub(/From:.*/, '') %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<% if data_integrity.nil? %>
  <div class="data-integrity project failure">
    Data Integrity Checker isn't working. Check admin.revieworld.com/data_integrity.json
  </div>
<% end %>

<div class="time">Checked the herd at <%= DateTime.now.strftime("%T") %></div>

<script type="text/javascript" charset="utf-8">
  status_update(<%= builds[:failure].size %>);
</script>
